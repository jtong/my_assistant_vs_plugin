<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSGradio Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #vsgradio-container {
            max-width: 600px;
            margin: 0 auto;
        }
        input, button {
            margin: 10px 0;
            padding: 5px;
        }
        button {
            cursor: pointer;
        }
        #outputs {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="vsgradio-container"></div>

    <script>
        const vscode = acquireVsCodeApi();
        let interfaceConfig = null;

        window.addEventListener('message', event => {
            const message = event.data;
            switch (message.type) {
                case 'setInterface':
                    interfaceConfig = message.value;
                    renderInterface(interfaceConfig);
                    break;
                case 'updateOutput':
                    updateOutput(message.value);
                    break;
            }
        });

        function renderInterface(config) {
            const container = document.getElementById('vsgradio-container');
            container.innerHTML = `
                <h2>${config.title}</h2>
                <div id="inputs">
                    ${config.inputs.map(renderInput).join('')}
                </div>
                <div id="outputs">
                    ${config.outputs.map(renderOutput).join('')}
                </div>
            `;
            setupEventListeners(config);
        }

        function renderInput(input) {
            if (input.type === 'text') {
                return `<input type="text" id="${input.label}" placeholder="${input.label}" value="${input.default || ''}">`;
            } else if (input.type === 'button') {
                return `<button id="${input.label}">${input.label}</button>`;
            }
            // 可以在这里添加更多输入类型
        }

        function renderOutput(output) {
            return `<div id="${output.label}">${output.label}: <span></span></div>`;
        }

        function setupEventListeners(config) {
            const button = document.querySelector('button');
            if (button) {
                button.addEventListener('click', () => {
                    const inputs = config.inputs
                        .filter(input => input.type === 'text')
                        .map(input => document.getElementById(input.label).value);
                    vscode.postMessage({
                        type: 'execute',
                        inputs: inputs
                    });
                });
            }
        }

        function updateOutput(value) {
            const outputElement = document.querySelector('#outputs span');
            if (outputElement) {
                outputElement.textContent = value;
            }
        }

        // 初始化时请求接口配置
        vscode.postMessage({ type: 'getInterface' });
    </script>
</body>
</html>